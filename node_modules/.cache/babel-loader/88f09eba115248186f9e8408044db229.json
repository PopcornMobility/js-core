{"ast":null,"code":"import _objectSpread from \"/Users/stefanm/Projects/js-core/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport _slicedToArray from \"/Users/stefanm/Projects/js-core/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _classCallCheck from \"/Users/stefanm/Projects/js-core/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/stefanm/Projects/js-core/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/stefanm/Projects/js-core/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/stefanm/Projects/js-core/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/stefanm/Projects/js-core/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _assertThisInitialized from \"/Users/stefanm/Projects/js-core/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _objectWithoutProperties from \"/Users/stefanm/Projects/js-core/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties\";\n\nvar _this = this,\n    _jsxFileName = \"/Users/stefanm/Projects/js-core/src/components/core/Menu/MenuLeft/index.js\",\n    _dec,\n    _class,\n    _temp;\n\nimport React from \"react\";\nimport { connect } from \"react-redux\";\nimport { Link, withRouter } from \"react-router-dom\";\nimport { Menu, Layout, Tag, Popover } from \"antd\";\nimport { LockOutlined } from \"@ant-design/icons\";\nimport store from \"store\";\nimport { Scrollbars } from \"react-custom-scrollbars\";\nimport _ from \"lodash\";\nimport { checkAccess } from \"../../../../utils/auth\";\nimport styles from \"./style.module.scss\";\nvar Sider = Layout.Sider;\nvar SubMenu = Menu.SubMenu,\n    Divider = Menu.Divider;\nvar isDebug = process.env.REACT_APP_PERMISSIONS_DEBUG === \"true\";\n\nvar DebugPopoverTitle = function DebugPopoverTitle(props) {\n  var isAuthorized = props.isAuthorized;\n  var color = isAuthorized ? \"green\" : \"red\";\n  return /*#__PURE__*/React.createElement(\"span\", {\n    style: {\n      color: color,\n      fontWeight: \"bold\"\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 24,\n      columnNumber: 5\n    }\n  }, isAuthorized ? \"Authorized\" : \"Not authorized\");\n};\n\nvar DebugPopoverContent = function DebugPopoverContent(props) {\n  var permissions = props.permissions,\n      roles = props.roles;\n  return /*#__PURE__*/React.createElement(React.Fragment, null, roles && /*#__PURE__*/React.createElement(\"div\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 36,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"b\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 37,\n      columnNumber: 11\n    }\n  }, \"Roles:\"), \" \", roles.map(function (role) {\n    return /*#__PURE__*/React.createElement(Tag, {\n      key: role,\n      className: \"mb-1\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 39,\n        columnNumber: 13\n      }\n    }, role);\n  })), permissions && /*#__PURE__*/React.createElement(\"div\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 46,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"b\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 47,\n      columnNumber: 11\n    }\n  }, \"Permissions:\"), \" \", permissions.map(function (perm) {\n    return /*#__PURE__*/React.createElement(Tag, {\n      key: perm,\n      className: \"mb-1\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 49,\n        columnNumber: 13\n      }\n    }, perm);\n  })));\n};\n\nvar DebugLock = function DebugLock(props) {\n  var isAuthorized = props.isAuthorized,\n      rest = _objectWithoutProperties(props, [\"isAuthorized\"]);\n\n  var color = isAuthorized ? \"green\" : \"red\";\n  var style = {\n    backgroundColor: \"white\",\n    borderRadius: 5,\n    padding: 2,\n    color: color,\n    position: \"absolute\",\n    right: -40,\n    top: 0\n  };\n  return /*#__PURE__*/React.createElement(LockOutlined, Object.assign({}, rest, {\n    style: style,\n    className: \"ml-2\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 72,\n      columnNumber: 10\n    }\n  }));\n};\n\nvar mapStateToProps = function mapStateToProps(_ref) {\n  var menu = _ref.menu,\n      settings = _ref.settings,\n      user = _ref.user;\n  return {\n    user: user,\n    badges: menu.badges,\n    isMenuCollapsed: settings.isMenuCollapsed,\n    isMobileView: settings.isMobileView,\n    isLightTheme: settings.isLightTheme\n  };\n};\n\nvar MenuLeft = (_dec = connect(mapStateToProps), withRouter(_class = _dec(_class = (_temp = /*#__PURE__*/function (_React$Component) {\n  _inherits(MenuLeft, _React$Component);\n\n  function MenuLeft() {\n    var _getPrototypeOf2;\n\n    var _this2;\n\n    _classCallCheck(this, MenuLeft);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this2 = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(MenuLeft)).call.apply(_getPrototypeOf2, [this].concat(args)));\n    _this2.state = {\n      selectedKeys: store.get(\"app.menu.selectedKeys\") || [],\n      openedKeys: store.get(\"app.menu.openedKeys\") || []\n    };\n\n    _this2.clearOpenedKeys = function () {\n      _this2.setState({\n        openedKeys: []\n      });\n\n      store.set(\"app.menu.openedKeys\", []);\n    };\n\n    _this2.setSelectedKeys = function () {\n      var _this2$props = _this2.props,\n          menu = _this2$props.menu,\n          location = _this2$props.location;\n\n      var flattenItems = function flattenItems(items, key) {\n        return items.reduce(function (flattenedItems, item) {\n          flattenedItems.push(item);\n\n          if (Array.isArray(item[key])) {\n            return flattenedItems.concat(flattenItems(item[key], key));\n          }\n\n          return flattenedItems;\n        }, []);\n      };\n\n      var selectedItem = _.find(flattenItems(menu, \"children\"), [\"url\", location.pathname]);\n\n      var _this2$state$selected = _slicedToArray(_this2.state.selectedKeys, 1),\n          currentSelection = _this2$state$selected[0]; // only update state when necessary\n\n\n      if (selectedItem && selectedItem.key !== currentSelection) {\n        _this2.setState({\n          selectedKeys: selectedItem ? [selectedItem.key] : []\n        });\n      }\n    };\n\n    _this2.onCollapse = function (value, type) {\n      var _this2$props2 = _this2.props,\n          dispatch = _this2$props2.dispatch,\n          isMenuCollapsed = _this2$props2.isMenuCollapsed;\n\n      if (type === \"responsive\" && isMenuCollapsed) {\n        return;\n      }\n\n      dispatch({\n        type: \"settings/CHANGE_SETTING\",\n        payload: {\n          setting: \"isMenuCollapsed\",\n          value: !isMenuCollapsed\n        }\n      });\n\n      _this2.setState({\n        openedKeys: []\n      });\n    };\n\n    _this2.onOpenChange = function (openedKeys) {\n      store.set(\"app.menu.openedKeys\", openedKeys);\n\n      _this2.setState({\n        openedKeys: openedKeys\n      });\n    };\n\n    _this2.handleClick = function (e) {\n      store.set(\"app.menu.selectedKeys\", [e.key]);\n\n      _this2.setState({\n        selectedKeys: [e.key]\n      });\n    };\n\n    _this2.generateMenuItems = function () {\n      var _this2$props3 = _this2.props,\n          _this2$props3$menu = _this2$props3.menu,\n          menu = _this2$props3$menu === void 0 ? [] : _this2$props3$menu,\n          badges = _this2$props3.badges,\n          _this2$props3$user = _this2$props3.user,\n          userRoles = _this2$props3$user.roles,\n          userPermissions = _this2$props3$user.permissions;\n\n      var isAuthorized = function isAuthorized(roles, permissions) {\n        return checkAccess(roles, userRoles) && checkAccess(permissions, userPermissions);\n      };\n\n      var generateItem = function generateItem(item) {\n        var key = item.key,\n            title = item.title,\n            url = item.url,\n            icon = item.icon,\n            disabled = item.disabled,\n            badge = item.badge,\n            roles = item.roles,\n            permissions = item.permissions;\n\n        if (item.divider) {\n          return /*#__PURE__*/React.createElement(Divider, {\n            key: Math.random(),\n            __self: _assertThisInitialized(_assertThisInitialized(_this2)),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 199,\n              columnNumber: 16\n            }\n          });\n        }\n\n        var authorized = isAuthorized(roles, permissions);\n        var debugPopover = isDebug && /*#__PURE__*/React.createElement(Popover, {\n          title: /*#__PURE__*/React.createElement(DebugPopoverTitle, {\n            isAuthorized: authorized,\n            __self: _assertThisInitialized(_assertThisInitialized(_this2)),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 206,\n              columnNumber: 18\n            }\n          }),\n          content: /*#__PURE__*/React.createElement(DebugPopoverContent, {\n            permissions: permissions,\n            roles: roles,\n            __self: _assertThisInitialized(_assertThisInitialized(_this2)),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 208,\n              columnNumber: 13\n            }\n          }),\n          zIndex: 1050,\n          __self: _assertThisInitialized(_assertThisInitialized(_this2)),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 205,\n            columnNumber: 9\n          }\n        }, /*#__PURE__*/React.createElement(DebugLock, {\n          isAuthorized: authorized,\n          __self: _assertThisInitialized(_assertThisInitialized(_this2)),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 212,\n            columnNumber: 11\n          }\n        }));\n\n        if (item.url) {\n          var itemWithUrl = item.target ? /*#__PURE__*/React.createElement(\"a\", {\n            href: url,\n            target: item.target,\n            rel: \"noopener noreferrer\",\n            __self: _assertThisInitialized(_assertThisInitialized(_this2)),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 218,\n              columnNumber: 11\n            }\n          }, icon && /*#__PURE__*/React.createElement(\"span\", {\n            className: \"\".concat(icon, \" \").concat(styles.icon, \" icon-collapsed-hidden\"),\n            __self: _assertThisInitialized(_assertThisInitialized(_this2)),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 220,\n              columnNumber: 15\n            }\n          }), /*#__PURE__*/React.createElement(\"span\", {\n            className: styles.title,\n            __self: _assertThisInitialized(_assertThisInitialized(_this2)),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 224,\n              columnNumber: 13\n            }\n          }, title, debugPopover), badge && /*#__PURE__*/React.createElement(\"span\", {\n            className: \"badge badge-light badge-collapsed-hidden ml-2\",\n            __self: _assertThisInitialized(_assertThisInitialized(_this2)),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 229,\n              columnNumber: 15\n            }\n          }, badges[badge])) : /*#__PURE__*/React.createElement(Link, {\n            to: url,\n            __self: _assertThisInitialized(_assertThisInitialized(_this2)),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 235,\n              columnNumber: 11\n            }\n          }, icon && /*#__PURE__*/React.createElement(\"span\", {\n            className: \"\".concat(icon, \" \").concat(styles.icon, \" icon-collapsed-hidden\"),\n            __self: _assertThisInitialized(_assertThisInitialized(_this2)),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 237,\n              columnNumber: 15\n            }\n          }), /*#__PURE__*/React.createElement(\"span\", {\n            className: styles.title,\n            __self: _assertThisInitialized(_assertThisInitialized(_this2)),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 241,\n              columnNumber: 13\n            }\n          }, title, debugPopover), badge && /*#__PURE__*/React.createElement(\"span\", {\n            className: \"badge badge-light badge-collapsed-hidden ml-2\",\n            __self: _assertThisInitialized(_assertThisInitialized(_this2)),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 246,\n              columnNumber: 15\n            }\n          }, badges[badge]));\n          return /*#__PURE__*/React.createElement(Menu.Item, {\n            key: key,\n            disabled: disabled,\n            __self: _assertThisInitialized(_assertThisInitialized(_this2)),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 254,\n              columnNumber: 11\n            }\n          }, itemWithUrl);\n        }\n\n        var normalItem = /*#__PURE__*/React.createElement(Menu.Item, {\n          key: key,\n          disabled: disabled,\n          __self: _assertThisInitialized(_assertThisInitialized(_this2)),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 261,\n            columnNumber: 9\n          }\n        }, icon && /*#__PURE__*/React.createElement(\"span\", {\n          className: \"\".concat(icon, \" \").concat(styles.icon, \" icon-collapsed-hidden\"),\n          __self: _assertThisInitialized(_assertThisInitialized(_this2)),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 263,\n            columnNumber: 13\n          }\n        }), /*#__PURE__*/React.createElement(\"span\", {\n          className: styles.title,\n          __self: _assertThisInitialized(_assertThisInitialized(_this2)),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 265,\n            columnNumber: 11\n          }\n        }, title, debugPopover), badge && /*#__PURE__*/React.createElement(\"span\", {\n          className: \"badge badge-light badge-collapsed-hidden ml-2\",\n          __self: _assertThisInitialized(_assertThisInitialized(_this2)),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 270,\n            columnNumber: 13\n          }\n        }, badges[badge]));\n        return normalItem;\n      };\n\n      var generateSubmenu = function generateSubmenu(items) {\n        return items.map(function (menuItem) {\n          var title = menuItem.title,\n              icon = menuItem.icon,\n              key = menuItem.key,\n              children = menuItem.children,\n              roles = menuItem.roles,\n              permissions = menuItem.permissions;\n          var authorized = isAuthorized(roles, permissions);\n\n          if (!isDebug && !authorized) {\n            return null;\n          }\n\n          var debugPopover = isDebug && /*#__PURE__*/React.createElement(Popover, {\n            title: /*#__PURE__*/React.createElement(DebugPopoverTitle, {\n              isAuthorized: authorized,\n              __self: _assertThisInitialized(_assertThisInitialized(_this2)),\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 292,\n                columnNumber: 20\n              }\n            }),\n            content: /*#__PURE__*/React.createElement(DebugPopoverContent, {\n              permissions: permissions,\n              roles: roles,\n              __self: _assertThisInitialized(_assertThisInitialized(_this2)),\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 294,\n                columnNumber: 15\n              }\n            }),\n            zIndex: 1050,\n            __self: _assertThisInitialized(_assertThisInitialized(_this2)),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 291,\n              columnNumber: 11\n            }\n          }, /*#__PURE__*/React.createElement(DebugLock, {\n            isAuthorized: authorized,\n            __self: _assertThisInitialized(_assertThisInitialized(_this2)),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 298,\n              columnNumber: 13\n            }\n          }));\n\n          if (children) {\n            var titleComponent = /*#__PURE__*/React.createElement(\"span\", {\n              key: key,\n              __self: _assertThisInitialized(_assertThisInitialized(_this2)),\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 304,\n                columnNumber: 13\n              }\n            }, /*#__PURE__*/React.createElement(\"span\", {\n              className: styles.title,\n              __self: _assertThisInitialized(_assertThisInitialized(_this2)),\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 305,\n                columnNumber: 15\n              }\n            }, title, debugPopover), icon && /*#__PURE__*/React.createElement(\"span\", {\n              className: \"\".concat(icon, \" \").concat(styles.icon),\n              __self: _assertThisInitialized(_assertThisInitialized(_this2)),\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 309,\n                columnNumber: 24\n              }\n            }));\n            return /*#__PURE__*/React.createElement(SubMenu, {\n              title: titleComponent,\n              key: key,\n              __self: _assertThisInitialized(_assertThisInitialized(_this2)),\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 314,\n                columnNumber: 13\n              }\n            }, generateSubmenu(children));\n          }\n\n          return generateItem(menuItem);\n        });\n      };\n\n      return generateSubmenu(menu);\n    };\n\n    return _this2;\n  }\n\n  _createClass(MenuLeft, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.setSelectedKeys();\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps) {\n      var _this$props = this.props,\n          isMenuCollapsed = _this$props.isMenuCollapsed,\n          isMobileView = _this$props.isMobileView;\n\n      if (prevProps.isMenuCollapsed !== isMenuCollapsed && !isMobileView) {\n        this.clearOpenedKeys();\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n\n      var _this$state = this.state,\n          selectedKeys = _this$state.selectedKeys,\n          openedKeys = _this$state.openedKeys;\n      var _this$props2 = this.props,\n          isMobileView = _this$props2.isMobileView,\n          isMenuCollapsed = _this$props2.isMenuCollapsed,\n          isLightTheme = _this$props2.isLightTheme;\n      var menuSettings = isMobileView ? {\n        width: 256,\n        collapsible: false,\n        collapsed: false,\n        onCollapse: this.onCollapse\n      } : {\n        width: 256,\n        collapsible: true,\n        collapsed: isMenuCollapsed,\n        onCollapse: this.onCollapse,\n        breakpoint: \"lg\"\n      };\n      var menu = this.generateMenuItems();\n      return /*#__PURE__*/React.createElement(Sider, Object.assign({}, menuSettings, {\n        className: isLightTheme ? \"\".concat(styles.menu, \" \").concat(styles.light) : styles.menu,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 347,\n          columnNumber: 7\n        }\n      }), /*#__PURE__*/React.createElement(\"div\", {\n        className: styles.logo,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 353,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: styles.logoContainer,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 354,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"img\", {\n        src: \"/resources/images/logo\".concat(menuSettings.collapsed ? \"-mobile\" : \"\", \".png\"),\n        alt: \"\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 355,\n          columnNumber: 13\n        }\n      }))), /*#__PURE__*/React.createElement(Scrollbars, {\n        className: isMobileView ? styles.scrollbarMobile : styles.scrollbarDesktop,\n        renderThumbVertical: function renderThumbVertical(_ref2) {\n          var style = _ref2.style,\n              props = _objectWithoutProperties(_ref2, [\"style\"]);\n\n          return /*#__PURE__*/React.createElement(\"div\", Object.assign({}, props, {\n            style: _objectSpread({}, style, {\n              width: \"4px\",\n              borderRadius: \"inherit\",\n              backgroundColor: \"#c5cdd2\",\n              left: \"1px\"\n            }),\n            __self: _this3,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 368,\n              columnNumber: 13\n            }\n          }));\n        },\n        autoHide: true,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 363,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(Menu, {\n        theme: isLightTheme ? \"light\" : \"dark\",\n        onClick: this.handleClick,\n        selectedKeys: selectedKeys,\n        openKeys: openedKeys,\n        onOpenChange: this.onOpenChange,\n        mode: \"inline\",\n        className: styles.navigation,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 381,\n          columnNumber: 11\n        }\n      }, menu)));\n    }\n  }]);\n\n  return MenuLeft;\n}(React.Component), _temp)) || _class) || _class);\nexport default MenuLeft;","map":{"version":3,"sources":["/Users/stefanm/Projects/js-core/src/components/core/Menu/MenuLeft/index.js"],"names":["React","connect","Link","withRouter","Menu","Layout","Tag","Popover","LockOutlined","store","Scrollbars","_","checkAccess","styles","Sider","SubMenu","Divider","isDebug","process","env","REACT_APP_PERMISSIONS_DEBUG","DebugPopoverTitle","props","isAuthorized","color","fontWeight","DebugPopoverContent","permissions","roles","map","role","perm","DebugLock","rest","style","backgroundColor","borderRadius","padding","position","right","top","mapStateToProps","menu","settings","user","badges","isMenuCollapsed","isMobileView","isLightTheme","MenuLeft","state","selectedKeys","get","openedKeys","clearOpenedKeys","setState","set","setSelectedKeys","location","flattenItems","items","key","reduce","flattenedItems","item","push","Array","isArray","concat","selectedItem","find","pathname","currentSelection","onCollapse","value","type","dispatch","payload","setting","onOpenChange","handleClick","e","generateMenuItems","userRoles","userPermissions","generateItem","title","url","icon","disabled","badge","divider","Math","random","authorized","debugPopover","itemWithUrl","target","normalItem","generateSubmenu","menuItem","children","titleComponent","prevProps","menuSettings","width","collapsible","collapsed","breakpoint","light","logo","logoContainer","scrollbarMobile","scrollbarDesktop","left","navigation","Component"],"mappings":"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","sourcesContent":["import React from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport { Link, withRouter } from \"react-router-dom\";\r\nimport { Menu, Layout, Tag, Popover } from \"antd\";\r\nimport { LockOutlined } from \"@ant-design/icons\";\r\nimport store from \"store\";\r\nimport { Scrollbars } from \"react-custom-scrollbars\";\r\nimport _ from \"lodash\";\r\n\r\nimport { checkAccess } from \"../../../../utils/auth\";\r\n\r\nimport styles from \"./style.module.scss\";\r\n\r\nconst { Sider } = Layout;\r\nconst { SubMenu, Divider } = Menu;\r\n\r\nconst isDebug = process.env.REACT_APP_PERMISSIONS_DEBUG === \"true\";\r\n\r\nconst DebugPopoverTitle = props => {\r\n  const { isAuthorized } = props;\r\n  const color = isAuthorized ? \"green\" : \"red\";\r\n\r\n  return (\r\n    <span style={{ color, fontWeight: \"bold\" }}>\r\n      {isAuthorized ? \"Authorized\" : \"Not authorized\"}\r\n    </span>\r\n  );\r\n};\r\n\r\nconst DebugPopoverContent = props => {\r\n  const { permissions, roles } = props;\r\n\r\n  return (\r\n    <>\r\n      {roles && (\r\n        <div>\r\n          <b>Roles:</b>{\" \"}\r\n          {roles.map(role => (\r\n            <Tag key={role} className=\"mb-1\">\r\n              {role}\r\n            </Tag>\r\n          ))}\r\n        </div>\r\n      )}\r\n      {permissions && (\r\n        <div>\r\n          <b>Permissions:</b>{\" \"}\r\n          {permissions.map(perm => (\r\n            <Tag key={perm} className=\"mb-1\">\r\n              {perm}\r\n            </Tag>\r\n          ))}\r\n        </div>\r\n      )}\r\n    </>\r\n  );\r\n};\r\n\r\nconst DebugLock = props => {\r\n  const { isAuthorized, ...rest } = props;\r\n  const color = isAuthorized ? \"green\" : \"red\";\r\n  const style = {\r\n    backgroundColor: \"white\",\r\n    borderRadius: 5,\r\n    padding: 2,\r\n    color,\r\n    position: \"absolute\",\r\n    right: -40,\r\n    top: 0\r\n  };\r\n\r\n  return <LockOutlined {...rest} style={style} className=\"ml-2\" />;\r\n};\r\n\r\nconst mapStateToProps = ({ menu, settings, user }) => ({\r\n  user,\r\n  badges: menu.badges,\r\n  isMenuCollapsed: settings.isMenuCollapsed,\r\n  isMobileView: settings.isMobileView,\r\n  isLightTheme: settings.isLightTheme\r\n});\r\n\r\n@withRouter\r\n@connect(mapStateToProps)\r\nclass MenuLeft extends React.Component {\r\n  state = {\r\n    selectedKeys: store.get(\"app.menu.selectedKeys\") || [],\r\n    openedKeys: store.get(\"app.menu.openedKeys\") || []\r\n  };\r\n\r\n  componentDidMount() {\r\n    this.setSelectedKeys();\r\n  }\r\n\r\n  componentDidUpdate(prevProps) {\r\n    const { isMenuCollapsed, isMobileView } = this.props;\r\n\r\n    if (prevProps.isMenuCollapsed !== isMenuCollapsed && !isMobileView) {\r\n      this.clearOpenedKeys();\r\n    }\r\n  }\r\n\r\n  clearOpenedKeys = () => {\r\n    this.setState({\r\n      openedKeys: []\r\n    });\r\n    store.set(\"app.menu.openedKeys\", []);\r\n  };\r\n\r\n  setSelectedKeys = () => {\r\n    const { menu, location } = this.props;\r\n\r\n    const flattenItems = (items, key) =>\r\n      items.reduce((flattenedItems, item) => {\r\n        flattenedItems.push(item);\r\n        if (Array.isArray(item[key])) {\r\n          return flattenedItems.concat(flattenItems(item[key], key));\r\n        }\r\n        return flattenedItems;\r\n      }, []);\r\n\r\n    const selectedItem = _.find(flattenItems(menu, \"children\"), [\r\n      \"url\",\r\n      location.pathname\r\n    ]);\r\n\r\n    const {\r\n      selectedKeys: [currentSelection]\r\n    } = this.state;\r\n\r\n    // only update state when necessary\r\n    if (selectedItem && selectedItem.key !== currentSelection) {\r\n      this.setState({\r\n        selectedKeys: selectedItem ? [selectedItem.key] : []\r\n      });\r\n    }\r\n  };\r\n\r\n  onCollapse = (value, type) => {\r\n    const { dispatch, isMenuCollapsed } = this.props;\r\n    if (type === \"responsive\" && isMenuCollapsed) {\r\n      return;\r\n    }\r\n\r\n    dispatch({\r\n      type: \"settings/CHANGE_SETTING\",\r\n      payload: {\r\n        setting: \"isMenuCollapsed\",\r\n        value: !isMenuCollapsed\r\n      }\r\n    });\r\n\r\n    this.setState({\r\n      openedKeys: []\r\n    });\r\n  };\r\n\r\n  onOpenChange = openedKeys => {\r\n    store.set(\"app.menu.openedKeys\", openedKeys);\r\n    this.setState({\r\n      openedKeys\r\n    });\r\n  };\r\n\r\n  handleClick = e => {\r\n    store.set(\"app.menu.selectedKeys\", [e.key]);\r\n    this.setState({\r\n      selectedKeys: [e.key]\r\n    });\r\n  };\r\n\r\n  generateMenuItems = () => {\r\n    const {\r\n      menu = [],\r\n      badges,\r\n      user: { roles: userRoles, permissions: userPermissions }\r\n    } = this.props;\r\n\r\n    const isAuthorized = (roles, permissions) => {\r\n      return (\r\n        checkAccess(roles, userRoles) &&\r\n        checkAccess(permissions, userPermissions)\r\n      );\r\n    };\r\n\r\n    const generateItem = item => {\r\n      const {\r\n        key,\r\n        title,\r\n        url,\r\n        icon,\r\n        disabled,\r\n        badge,\r\n        roles,\r\n        permissions\r\n      } = item;\r\n\r\n      if (item.divider) {\r\n        return <Divider key={Math.random()} />;\r\n      }\r\n\r\n      const authorized = isAuthorized(roles, permissions);\r\n\r\n      const debugPopover = isDebug && (\r\n        <Popover\r\n          title={<DebugPopoverTitle isAuthorized={authorized} />}\r\n          content={\r\n            <DebugPopoverContent permissions={permissions} roles={roles} />\r\n          }\r\n          zIndex={1050}\r\n        >\r\n          <DebugLock isAuthorized={authorized} />\r\n        </Popover>\r\n      );\r\n\r\n      if (item.url) {\r\n        const itemWithUrl = item.target ? (\r\n          <a href={url} target={item.target} rel=\"noopener noreferrer\">\r\n            {icon && (\r\n              <span\r\n                className={`${icon} ${styles.icon} icon-collapsed-hidden`}\r\n              />\r\n            )}\r\n            <span className={styles.title}>\r\n              {title}\r\n              {debugPopover}\r\n            </span>\r\n            {badge && (\r\n              <span className=\"badge badge-light badge-collapsed-hidden ml-2\">\r\n                {badges[badge]}\r\n              </span>\r\n            )}\r\n          </a>\r\n        ) : (\r\n          <Link to={url}>\r\n            {icon && (\r\n              <span\r\n                className={`${icon} ${styles.icon} icon-collapsed-hidden`}\r\n              />\r\n            )}\r\n            <span className={styles.title}>\r\n              {title}\r\n              {debugPopover}\r\n            </span>\r\n            {badge && (\r\n              <span className=\"badge badge-light badge-collapsed-hidden ml-2\">\r\n                {badges[badge]}\r\n              </span>\r\n            )}\r\n          </Link>\r\n        );\r\n\r\n        return (\r\n          <Menu.Item key={key} disabled={disabled}>\r\n            {itemWithUrl}\r\n          </Menu.Item>\r\n        );\r\n      }\r\n\r\n      const normalItem = (\r\n        <Menu.Item key={key} disabled={disabled}>\r\n          {icon && (\r\n            <span className={`${icon} ${styles.icon} icon-collapsed-hidden`} />\r\n          )}\r\n          <span className={styles.title}>\r\n            {title}\r\n            {debugPopover}\r\n          </span>\r\n          {badge && (\r\n            <span className=\"badge badge-light badge-collapsed-hidden ml-2\">\r\n              {badges[badge]}\r\n            </span>\r\n          )}\r\n        </Menu.Item>\r\n      );\r\n\r\n      return normalItem;\r\n    };\r\n\r\n    const generateSubmenu = items =>\r\n      items.map(menuItem => {\r\n        const { title, icon, key, children, roles, permissions } = menuItem;\r\n\r\n        const authorized = isAuthorized(roles, permissions);\r\n\r\n        if (!isDebug && !authorized) {\r\n          return null;\r\n        }\r\n\r\n        const debugPopover = isDebug && (\r\n          <Popover\r\n            title={<DebugPopoverTitle isAuthorized={authorized} />}\r\n            content={\r\n              <DebugPopoverContent permissions={permissions} roles={roles} />\r\n            }\r\n            zIndex={1050}\r\n          >\r\n            <DebugLock isAuthorized={authorized} />\r\n          </Popover>\r\n        );\r\n\r\n        if (children) {\r\n          const titleComponent = (\r\n            <span key={key}>\r\n              <span className={styles.title}>\r\n                {title}\r\n                {debugPopover}\r\n              </span>\r\n              {icon && <span className={`${icon} ${styles.icon}`} />}\r\n            </span>\r\n          );\r\n\r\n          return (\r\n            <SubMenu title={titleComponent} key={key}>\r\n              {generateSubmenu(children)}\r\n            </SubMenu>\r\n          );\r\n        }\r\n\r\n        return generateItem(menuItem);\r\n      });\r\n\r\n    return generateSubmenu(menu);\r\n  };\r\n\r\n  render() {\r\n    const { selectedKeys, openedKeys } = this.state;\r\n    const { isMobileView, isMenuCollapsed, isLightTheme } = this.props;\r\n    const menuSettings = isMobileView\r\n      ? {\r\n          width: 256,\r\n          collapsible: false,\r\n          collapsed: false,\r\n          onCollapse: this.onCollapse\r\n        }\r\n      : {\r\n          width: 256,\r\n          collapsible: true,\r\n          collapsed: isMenuCollapsed,\r\n          onCollapse: this.onCollapse,\r\n          breakpoint: \"lg\"\r\n        };\r\n\r\n    const menu = this.generateMenuItems();\r\n\r\n    return (\r\n      <Sider\r\n        {...menuSettings}\r\n        className={\r\n          isLightTheme ? `${styles.menu} ${styles.light}` : styles.menu\r\n        }\r\n      >\r\n        <div className={styles.logo}>\r\n          <div className={styles.logoContainer}>\r\n            <img\r\n              src={`/resources/images/logo${\r\n                menuSettings.collapsed ? \"-mobile\" : \"\"\r\n              }.png`}\r\n              alt=\"\"\r\n            />\r\n          </div>\r\n        </div>\r\n        <Scrollbars\r\n          className={\r\n            isMobileView ? styles.scrollbarMobile : styles.scrollbarDesktop\r\n          }\r\n          renderThumbVertical={({ style, ...props }) => (\r\n            <div\r\n              {...props}\r\n              style={{\r\n                ...style,\r\n                width: \"4px\",\r\n                borderRadius: \"inherit\",\r\n                backgroundColor: \"#c5cdd2\",\r\n                left: \"1px\"\r\n              }}\r\n            />\r\n          )}\r\n          autoHide\r\n        >\r\n          <Menu\r\n            theme={isLightTheme ? \"light\" : \"dark\"}\r\n            onClick={this.handleClick}\r\n            selectedKeys={selectedKeys}\r\n            openKeys={openedKeys}\r\n            onOpenChange={this.onOpenChange}\r\n            mode=\"inline\"\r\n            className={styles.navigation}\r\n          >\r\n            {menu}\r\n          </Menu>\r\n        </Scrollbars>\r\n      </Sider>\r\n    );\r\n  }\r\n}\r\n\r\nexport default MenuLeft;\r\n"]},"metadata":{},"sourceType":"module"}
{"ast":null,"code":"import _classCallCheck from \"/Users/stefanm/Projects/js-core/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/stefanm/Projects/js-core/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/stefanm/Projects/js-core/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/stefanm/Projects/js-core/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/stefanm/Projects/js-core/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\n\nvar _this = this,\n    _jsxFileName = \"/Users/stefanm/Projects/js-core/src/components/core/Authorize/index.js\",\n    _dec,\n    _class;\n\nimport React from 'react';\nimport { connect } from 'react-redux';\nimport { Redirect } from 'react-router-dom';\nimport { Icon, notification, Popover, Tag } from 'antd';\nimport { checkAccess } from 'utils/auth';\nimport './style.css';\nvar isDebug = process.env.REACT_APP_PERMISSIONS_DEBUG === 'true';\n\nvar DebugContainer = function DebugContainer(props) {\n  var isAuthorized = props.isAuthorized,\n      permissions = props.permissions,\n      roles = props.roles,\n      children = props.children;\n  var color = isAuthorized ? 'green' : 'red';\n  var style = {\n    display: 'inherit',\n    position: 'relative',\n    boxShadow: \"0px 0px 0px 1px \".concat(color, \" inset\"),\n    padding: 5,\n    borderRadius: 5\n  };\n  var lockStyle = {\n    color: color\n  };\n  var content = /*#__PURE__*/React.createElement(React.Fragment, null, roles && /*#__PURE__*/React.createElement(\"div\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 32,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"b\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 33,\n      columnNumber: 11\n    }\n  }, \"Roles:\"), ' ', roles.map(function (role) {\n    return /*#__PURE__*/React.createElement(Tag, {\n      key: role,\n      className: \"mb-1\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 35,\n        columnNumber: 13\n      }\n    }, role);\n  })), permissions && /*#__PURE__*/React.createElement(\"div\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 42,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"b\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 43,\n      columnNumber: 11\n    }\n  }, \"Permissions:\"), ' ', permissions.map(function (perm) {\n    return /*#__PURE__*/React.createElement(Tag, {\n      key: perm,\n      className: \"mb-1\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 45,\n        columnNumber: 13\n      }\n    }, perm);\n  })));\n  var title = /*#__PURE__*/React.createElement(\"span\", {\n    style: {\n      color: color,\n      fontWeight: 'bold'\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 55,\n      columnNumber: 5\n    }\n  }, isAuthorized ? 'Authorized' : 'Not authorized');\n  return /*#__PURE__*/React.createElement(\"div\", {\n    style: style,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 61,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(Popover, {\n    title: title,\n    content: content,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 62,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    style: lockStyle,\n    className: \"auth-lock\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 63,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Icon, {\n    type: \"lock\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 64,\n      columnNumber: 11\n    }\n  }))), children);\n};\n\nvar Authorize = (_dec = connect(function (_ref) {\n  var user = _ref.user;\n  return {\n    user: user\n  };\n}), _dec(_class = /*#__PURE__*/function (_React$Component) {\n  _inherits(Authorize, _React$Component);\n\n  function Authorize() {\n    _classCallCheck(this, Authorize);\n\n    return _possibleConstructorReturn(this, _getPrototypeOf(Authorize).apply(this, arguments));\n  }\n\n  _createClass(Authorize, [{\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var _this$props$user = this.props.user,\n          userRoles = _this$props$user.roles,\n          userPermissions = _this$props$user.permissions; // current user role\n\n      var _this$props = this.props,\n          children = _this$props.children,\n          _this$props$redirect = _this$props.redirect,\n          redirect = _this$props$redirect === void 0 ? false : _this$props$redirect,\n          _this$props$to = _this$props.to,\n          to = _this$props$to === void 0 ? '/404' : _this$props$to,\n          roles = _this$props.roles,\n          permissions = _this$props.permissions,\n          notify = _this$props.notify,\n          _this$props$unauthori = _this$props.unauthorized,\n          unauthorized = _this$props$unauthori === void 0 ? null : _this$props$unauthori;\n      var authorized = checkAccess(roles, userRoles) && checkAccess(permissions, userPermissions);\n\n      var AuthorizedChildren = function AuthorizedChildren() {\n        // if user not equal needed role and if component is a page - make redirect to needed route\n        if (!authorized && redirect) {\n          if (notify) {\n            notification.error({\n              message: 'Unauthorized access',\n              description: 'You cannot access this page.'\n            });\n          }\n\n          return /*#__PURE__*/React.createElement(Redirect, {\n            to: to,\n            __self: _this2,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 100,\n              columnNumber: 16\n            }\n          });\n        } // if user not authorized return null to component\n\n\n        if (!authorized && !isDebug) {\n          return unauthorized;\n        }\n\n        if (!authorized && isDebug) {\n          return /*#__PURE__*/React.createElement(DebugContainer, {\n            isAuthorized: false,\n            permissions: permissions,\n            roles: roles,\n            __self: _this2,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 110,\n              columnNumber: 11\n            }\n          }, children);\n        }\n\n        if (isDebug) {\n          return /*#__PURE__*/React.createElement(DebugContainer, {\n            isAuthorized: true,\n            permissions: permissions,\n            roles: roles,\n            __self: _this2,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 118,\n              columnNumber: 11\n            }\n          }, children);\n        } // if access is successful render children\n\n\n        return /*#__PURE__*/React.createElement(React.Fragment, null, children);\n      };\n\n      return AuthorizedChildren();\n    }\n  }]);\n\n  return Authorize;\n}(React.Component)) || _class);\nexport default Authorize;","map":{"version":3,"sources":["/Users/stefanm/Projects/js-core/src/components/core/Authorize/index.js"],"names":["React","connect","Redirect","Icon","notification","Popover","Tag","checkAccess","isDebug","process","env","REACT_APP_PERMISSIONS_DEBUG","DebugContainer","props","isAuthorized","permissions","roles","children","color","style","display","position","boxShadow","padding","borderRadius","lockStyle","content","map","role","perm","title","fontWeight","Authorize","user","userRoles","userPermissions","redirect","to","notify","unauthorized","authorized","AuthorizedChildren","error","message","description","Component"],"mappings":";;;;;;;;;;;AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,SAASC,OAAT,QAAwB,aAAxB;AACA,SAASC,QAAT,QAAyB,kBAAzB;AACA,SAASC,IAAT,EAAeC,YAAf,EAA6BC,OAA7B,EAAsCC,GAAtC,QAAiD,MAAjD;AAEA,SAASC,WAAT,QAA4B,YAA5B;AAEA,OAAO,aAAP;AAEA,IAAMC,OAAO,GAAGC,OAAO,CAACC,GAAR,CAAYC,2BAAZ,KAA4C,MAA5D;;AAEA,IAAMC,cAAc,GAAG,SAAjBA,cAAiB,CAAAC,KAAK,EAAI;AAAA,MACtBC,YADsB,GACyBD,KADzB,CACtBC,YADsB;AAAA,MACRC,WADQ,GACyBF,KADzB,CACRE,WADQ;AAAA,MACKC,KADL,GACyBH,KADzB,CACKG,KADL;AAAA,MACYC,QADZ,GACyBJ,KADzB,CACYI,QADZ;AAG9B,MAAMC,KAAK,GAAGJ,YAAY,GAAG,OAAH,GAAa,KAAvC;AAEA,MAAMK,KAAK,GAAG;AACZC,IAAAA,OAAO,EAAE,SADG;AAEZC,IAAAA,QAAQ,EAAE,UAFE;AAGZC,IAAAA,SAAS,4BAAqBJ,KAArB,WAHG;AAIZK,IAAAA,OAAO,EAAE,CAJG;AAKZC,IAAAA,YAAY,EAAE;AALF,GAAd;AAQA,MAAMC,SAAS,GAAG;AAChBP,IAAAA,KAAK,EAALA;AADgB,GAAlB;AAIA,MAAMQ,OAAO,gBACX,0CACGV,KAAK,iBACJ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cADF,EACgB,GADhB,EAEGA,KAAK,CAACW,GAAN,CAAU,UAAAC,IAAI;AAAA,wBACb,oBAAC,GAAD;AAAK,MAAA,GAAG,EAAEA,IAAV;AAAgB,MAAA,SAAS,EAAC,MAA1B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACGA,IADH,CADa;AAAA,GAAd,CAFH,CAFJ,EAWGb,WAAW,iBACV;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBADF,EACsB,GADtB,EAEGA,WAAW,CAACY,GAAZ,CAAgB,UAAAE,IAAI;AAAA,wBACnB,oBAAC,GAAD;AAAK,MAAA,GAAG,EAAEA,IAAV;AAAgB,MAAA,SAAS,EAAC,MAA1B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACGA,IADH,CADmB;AAAA,GAApB,CAFH,CAZJ,CADF;AAyBA,MAAMC,KAAK,gBACT;AAAM,IAAA,KAAK,EAAE;AAAEZ,MAAAA,KAAK,EAALA,KAAF;AAASa,MAAAA,UAAU,EAAE;AAArB,KAAb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACGjB,YAAY,GAAG,YAAH,GAAkB,gBADjC,CADF;AAMA,sBACE;AAAK,IAAA,KAAK,EAAEK,KAAZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACE,oBAAC,OAAD;AAAS,IAAA,KAAK,EAAEW,KAAhB;AAAuB,IAAA,OAAO,EAAEJ,OAAhC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACE;AAAK,IAAA,KAAK,EAAED,SAAZ;AAAuB,IAAA,SAAS,EAAC,WAAjC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACE,oBAAC,IAAD;AAAM,IAAA,IAAI,EAAC,MAAX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADF,CADF,CADF,EAOGR,QAPH,CADF;AAWD,CA3DD;;IA8DMe,S,WADL/B,OAAO,CAAC;AAAA,MAAGgC,IAAH,QAAGA,IAAH;AAAA,SAAe;AAAEA,IAAAA,IAAI,EAAJA;AAAF,GAAf;AAAA,CAAD,C;;;;;;;;;;;6BAEG;AAAA;;AAAA,6BAGH,KAAKpB,KAHF,CAELoB,IAFK;AAAA,UAEUC,SAFV,oBAEGlB,KAFH;AAAA,UAEkCmB,eAFlC,oBAEqBpB,WAFrB,EAGQ;;AAHR,wBAYH,KAAKF,KAZF;AAAA,UAKLI,QALK,eAKLA,QALK;AAAA,6CAMLmB,QANK;AAAA,UAMLA,QANK,qCAMM,KANN;AAAA,uCAOLC,EAPK;AAAA,UAOLA,EAPK,+BAOA,MAPA;AAAA,UAQLrB,KARK,eAQLA,KARK;AAAA,UASLD,WATK,eASLA,WATK;AAAA,UAULuB,MAVK,eAULA,MAVK;AAAA,8CAWLC,YAXK;AAAA,UAWLA,YAXK,sCAWU,IAXV;AAcP,UAAMC,UAAU,GAAGjC,WAAW,CAACS,KAAD,EAAQkB,SAAR,CAAX,IAAiC3B,WAAW,CAACQ,WAAD,EAAcoB,eAAd,CAA/D;;AAEA,UAAMM,kBAAkB,GAAG,SAArBA,kBAAqB,GAAM;AAC/B;AACA,YAAI,CAACD,UAAD,IAAeJ,QAAnB,EAA6B;AAC3B,cAAIE,MAAJ,EAAY;AACVlC,YAAAA,YAAY,CAACsC,KAAb,CAAmB;AACjBC,cAAAA,OAAO,EAAE,qBADQ;AAEjBC,cAAAA,WAAW,EAAE;AAFI,aAAnB;AAID;;AACD,8BAAO,oBAAC,QAAD;AAAU,YAAA,EAAE,EAAEP,EAAd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YAAP;AACD,SAV8B,CAY/B;;;AACA,YAAI,CAACG,UAAD,IAAe,CAAChC,OAApB,EAA6B;AAC3B,iBAAO+B,YAAP;AACD;;AAED,YAAI,CAACC,UAAD,IAAehC,OAAnB,EAA4B;AAC1B,8BACE,oBAAC,cAAD;AAAgB,YAAA,YAAY,EAAE,KAA9B;AAAqC,YAAA,WAAW,EAAEO,WAAlD;AAA+D,YAAA,KAAK,EAAEC,KAAtE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,aACGC,QADH,CADF;AAKD;;AAED,YAAIT,OAAJ,EAAa;AACX,8BACE,oBAAC,cAAD;AAAgB,YAAA,YAAY,MAA5B;AAA6B,YAAA,WAAW,EAAEO,WAA1C;AAAuD,YAAA,KAAK,EAAEC,KAA9D;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,aACGC,QADH,CADF;AAKD,SA/B8B,CAiC/B;;;AACA,4BAAO,0CAAGA,QAAH,CAAP;AACD,OAnCD;;AAqCA,aAAOwB,kBAAkB,EAAzB;AACD;;;;EAvDqBzC,KAAK,CAAC6C,S;AA0D9B,eAAeb,SAAf","sourcesContent":["import React from 'react'\nimport { connect } from 'react-redux'\nimport { Redirect } from 'react-router-dom'\nimport { Icon, notification, Popover, Tag } from 'antd'\n\nimport { checkAccess } from 'utils/auth'\n\nimport './style.css'\n\nconst isDebug = process.env.REACT_APP_PERMISSIONS_DEBUG === 'true'\n\nconst DebugContainer = props => {\n  const { isAuthorized, permissions, roles, children } = props\n\n  const color = isAuthorized ? 'green' : 'red'\n\n  const style = {\n    display: 'inherit',\n    position: 'relative',\n    boxShadow: `0px 0px 0px 1px ${color} inset`,\n    padding: 5,\n    borderRadius: 5,\n  }\n\n  const lockStyle = {\n    color,\n  }\n\n  const content = (\n    <>\n      {roles && (\n        <div>\n          <b>Roles:</b>{' '}\n          {roles.map(role => (\n            <Tag key={role} className=\"mb-1\">\n              {role}\n            </Tag>\n          ))}\n        </div>\n      )}\n      {permissions && (\n        <div>\n          <b>Permissions:</b>{' '}\n          {permissions.map(perm => (\n            <Tag key={perm} className=\"mb-1\">\n              {perm}\n            </Tag>\n          ))}\n        </div>\n      )}\n    </>\n  )\n\n  const title = (\n    <span style={{ color, fontWeight: 'bold' }}>\n      {isAuthorized ? 'Authorized' : 'Not authorized'}\n    </span>\n  )\n\n  return (\n    <div style={style}>\n      <Popover title={title} content={content}>\n        <div style={lockStyle} className=\"auth-lock\">\n          <Icon type=\"lock\" />\n        </div>\n      </Popover>\n\n      {children}\n    </div>\n  )\n}\n\n@connect(({ user }) => ({ user }))\nclass Authorize extends React.Component {\n  render() {\n    const {\n      user: { roles: userRoles, permissions: userPermissions },\n    } = this.props // current user role\n    const {\n      children,\n      redirect = false,\n      to = '/404',\n      roles,\n      permissions,\n      notify,\n      unauthorized = null,\n    } = this.props\n\n    const authorized = checkAccess(roles, userRoles) && checkAccess(permissions, userPermissions)\n\n    const AuthorizedChildren = () => {\n      // if user not equal needed role and if component is a page - make redirect to needed route\n      if (!authorized && redirect) {\n        if (notify) {\n          notification.error({\n            message: 'Unauthorized access',\n            description: 'You cannot access this page.',\n          })\n        }\n        return <Redirect to={to} />\n      }\n\n      // if user not authorized return null to component\n      if (!authorized && !isDebug) {\n        return unauthorized\n      }\n\n      if (!authorized && isDebug) {\n        return (\n          <DebugContainer isAuthorized={false} permissions={permissions} roles={roles}>\n            {children}\n          </DebugContainer>\n        )\n      }\n\n      if (isDebug) {\n        return (\n          <DebugContainer isAuthorized permissions={permissions} roles={roles}>\n            {children}\n          </DebugContainer>\n        )\n      }\n\n      // if access is successful render children\n      return <>{children}</>\n    }\n\n    return AuthorizedChildren()\n  }\n}\n\nexport default Authorize\n"]},"metadata":{},"sourceType":"module"}
{"ast":null,"code":"import _objectSpread from \"/Users/stefanm/Projects/js-core/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport _objectWithoutProperties from \"/Users/stefanm/Projects/js-core/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties\";\nimport _regeneratorRuntime from \"/Users/stefanm/Projects/js-core/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/stefanm/Projects/js-core/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/Users/stefanm/Projects/js-core/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/stefanm/Projects/js-core/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/stefanm/Projects/js-core/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/stefanm/Projects/js-core/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/stefanm/Projects/js-core/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/stefanm/Projects/js-core/src/components/generic/DataTable/remoteFilter.js\";\nimport React from 'react';\nimport { Select, Spin } from 'antd';\nimport debounce from 'lodash/debounce';\nimport isObject from 'lodash/isObject';\nvar Option = Select.Option;\nvar latestFetch = 0;\n\nvar RemoteFilter = /*#__PURE__*/function (_React$Component) {\n  _inherits(RemoteFilter, _React$Component);\n\n  function RemoteFilter(props) {\n    var _this;\n\n    _classCallCheck(this, RemoteFilter);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(RemoteFilter).call(this, props));\n    _this.state = {\n      data: [],\n      value: [],\n      fetching: false\n    };\n\n    _this.fetchData = /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(value) {\n        var _this$props$remoteSea, apiFn, paramSearchQuery, params, fetchID, data;\n\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                if (value) {\n                  _context.next = 2;\n                  break;\n                }\n\n                return _context.abrupt(\"return\");\n\n              case 2:\n                _this.setState({\n                  data: [],\n                  fetching: true\n                });\n\n                _this$props$remoteSea = _this.props.remoteSearch, apiFn = _this$props$remoteSea.apiFn, paramSearchQuery = _this$props$remoteSea.paramSearchQuery;\n                params = {};\n                params[paramSearchQuery] = value; // Update state 'data' with latest triggered fetch\n\n                latestFetch += 1;\n                fetchID = latestFetch;\n                _context.next = 10;\n                return apiFn(params);\n\n              case 10:\n                data = _context.sent;\n\n                if (fetchID === latestFetch) {\n                  _this.setState({\n                    data: data,\n                    fetching: false\n                  });\n                }\n\n              case 12:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }();\n\n    _this.handleChange = function (value) {\n      var _this$props$tableDrop = _this.props.tableDropdownFn,\n          setSelectedKeys = _this$props$tableDrop.setSelectedKeys,\n          confirm = _this$props$tableDrop.confirm;\n      setSelectedKeys(value ? [value] : null);\n      confirm();\n\n      _this.setState({\n        value: value,\n        data: [],\n        fetching: false\n      });\n    };\n\n    _this.fetchData = debounce(_this.fetchData, 800);\n    return _this;\n  }\n\n  _createClass(RemoteFilter, [{\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      // eslint-disable-next-line no-unused-vars\n      var _this$state = this.state,\n          fetching = _this$state.fetching,\n          data = _this$state.data,\n          value = _this$state.value;\n\n      var _this$props$remoteSea2 = this.props.remoteSearch,\n          apiFn = _this$props$remoteSea2.apiFn,\n          paramSearchQuery = _this$props$remoteSea2.paramSearchQuery,\n          styleSelect = _this$props$remoteSea2.styleSelect,\n          rest = _objectWithoutProperties(_this$props$remoteSea2, [\"apiFn\", \"paramSearchQuery\", \"styleSelect\"]);\n\n      return /*#__PURE__*/React.createElement(Select, Object.assign({}, rest, {\n        // DO NOT modify below default props\n        style: styleSelect ? _objectSpread({}, styleSelect) : {\n          width: '100%',\n          marginBottom: 8,\n          marginTop: 8\n        },\n        showSearch: true,\n        onSearch: this.fetchData,\n        onChange: this.handleChange,\n        onFocus: function onFocus() {\n          return _this2.fetchData(' ');\n        },\n        notFoundContent: fetching ? /*#__PURE__*/React.createElement(Spin, {\n          size: \"small\",\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 80,\n            columnNumber: 37\n          }\n        }) : null,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 72,\n          columnNumber: 7\n        }\n      }), data.map(function (d) {\n        var isString = !isObject(d);\n        return /*#__PURE__*/React.createElement(Option, {\n          key: d,\n          value: isString ? d : d.value,\n          title: isString ? d : d.text,\n          __self: _this2,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 86,\n            columnNumber: 13\n          }\n        }, isString ? d : d.text);\n      }));\n    }\n  }]);\n\n  return RemoteFilter;\n}(React.Component);\n\nexport default RemoteFilter;","map":{"version":3,"sources":["/Users/stefanm/Projects/js-core/src/components/generic/DataTable/remoteFilter.js"],"names":["React","Select","Spin","debounce","isObject","Option","latestFetch","RemoteFilter","props","state","data","value","fetching","fetchData","setState","remoteSearch","apiFn","paramSearchQuery","params","fetchID","handleChange","tableDropdownFn","setSelectedKeys","confirm","styleSelect","rest","width","marginBottom","marginTop","map","d","isString","text","Component"],"mappings":"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","sourcesContent":["import React from 'react'\nimport { Select, Spin } from 'antd'\nimport debounce from 'lodash/debounce'\nimport isObject from 'lodash/isObject'\n\nconst { Option } = Select\n\nlet latestFetch = 0\n\nclass RemoteFilter extends React.Component {\n  constructor(props) {\n    super(props)\n    this.fetchData = debounce(this.fetchData, 800)\n  }\n\n  state = {\n    data: [],\n    value: [],\n    fetching: false,\n  }\n\n  fetchData = async value => {\n    if (!value) {\n      return\n    }\n\n    this.setState({ data: [], fetching: true })\n\n    const {\n      remoteSearch: { apiFn, paramSearchQuery },\n    } = this.props\n\n    const params = {}\n    params[paramSearchQuery] = value\n\n    // Update state 'data' with latest triggered fetch\n    latestFetch += 1\n    const fetchID = latestFetch\n\n    const data = await apiFn(params)\n\n    if (fetchID === latestFetch) {\n      this.setState({ data, fetching: false })\n    }\n  }\n\n  handleChange = value => {\n    const {\n      tableDropdownFn: { setSelectedKeys, confirm },\n    } = this.props\n\n    setSelectedKeys(value ? [value] : null)\n\n    confirm()\n\n    this.setState({\n      value,\n      data: [],\n      fetching: false,\n    })\n  }\n\n  render() {\n    // eslint-disable-next-line no-unused-vars\n    const { fetching, data, value } = this.state\n\n    const {\n      remoteSearch: { apiFn, paramSearchQuery, styleSelect, ...rest },\n    } = this.props\n\n    return (\n      <Select\n        {...rest}\n        // DO NOT modify below default props\n        style={styleSelect ? { ...styleSelect } : { width: '100%', marginBottom: 8, marginTop: 8 }}\n        showSearch\n        onSearch={this.fetchData}\n        onChange={this.handleChange}\n        onFocus={() => this.fetchData(' ')}\n        notFoundContent={fetching ? <Spin size=\"small\" /> : null}\n      >\n        {data.map(d => {\n          const isString = !isObject(d)\n\n          return (\n            <Option key={d} value={isString ? d : d.value} title={isString ? d : d.text}>\n              {isString ? d : d.text}\n            </Option>\n          )\n        })}\n      </Select>\n    )\n  }\n}\n\nexport default RemoteFilter\n"]},"metadata":{},"sourceType":"module"}